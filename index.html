<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Simple URL Shortener</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 600px; margin: auto; }
    input, button { padding: 8px; margin: 5px 0; width: 100%; font-size: 1em; }
    ul { list-style: none; padding-left: 0; }
    li { margin-bottom: 10px; }
    .short-url { font-weight: bold; color: blue; cursor: pointer; text-decoration: underline; }
    .analytics { font-size: 0.9em; color: gray; margin-left: 10px; }
  </style>
</head>
<body>
  <h2>HTML URL Shortener (Client-side)</h2>

  <label>Enter Long URL:</label>
  <input type="text" id="longUrl" placeholder="https://example.com/very/long/url" />
  
  <label>Validity (minutes, optional):</label>
  <input type="number" id="validity" placeholder="30" min="1" />

  <button id="shortenBtn">Generate Short URL</button>

  <h3>Shortened URLs</h3>
  <ul id="shortUrlList"></ul>

  <script>
    const shortUrls = {};

    function generateShortCode(length = 6) {
      const chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
      let shortCode = '';
      for(let i = 0; i < length; i++) {
        shortCode += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      return shortCode;
    }

    function createShortUrl(longUrl, validityMins) {
      // Generate unique short code
      let shortCode;
      do {
        shortCode = generateShortCode(6);
      } while(shortUrls.hasOwnProperty(shortCode));

      const expiry = Date.now() + (validityMins || 30) * 60000; // default 30 mins expiry

      shortUrls[shortCode] = {
        url: longUrl,
        expiry,
        count: 0
      };
      return shortCode;
    }

    function displayShortUrls() {
      const list = document.getElementById('shortUrlList');
      list.innerHTML = '';
      for(const shortCode in shortUrls) {
        const data = shortUrls[shortCode];
        const now = Date.now();
        const isExpired = now > data.expiry;
        const li = document.createElement('li');

        const urlSpan = document.createElement('span');
        urlSpan.textContent = `${window.location.origin}/${shortCode}`;
        urlSpan.className = 'short-url';
        urlSpan.title = data.url;
        urlSpan.onclick = () => {
          if (isExpired) {
            alert('This short URL has expired.');
            return;
          }
          data.count++;
          window.open(data.url, '_blank');
          displayShortUrls();
        };

        const analyticsSpan = document.createElement('span');
        analyticsSpan.className = 'analytics';
        analyticsSpan.textContent = `(Accesses: ${data.count})${isExpired ? ' [EXPIRED]' : ''}`;

        li.appendChild(urlSpan);
        li.appendChild(analyticsSpan);
        list.appendChild(li);
      }
    }

    document.getElementById('shortenBtn').addEventListener('click', () => {
      const longUrl = document.getElementById('longUrl').value.trim();
      if(!longUrl) {
        alert("Please enter a URL.");
        return;
      }
      try {
        new URL(longUrl);
      } catch {
        alert("Invalid URL format.");
        return;
      }
      let validity = parseInt(document.getElementById('validity').value, 10);
      if (isNaN(validity) || validity <= 0) {
        validity = 30; // default 30 mins if invalid
      }
      const shortCode = createShortUrl(longUrl, validity);
      alert(`Short URL: ${window.location.origin}/${shortCode} (valid for ${validity} minutes)`);
      displayShortUrls();
      document.getElementById('longUrl').value = '';
      document.getElementById('validity').value = '';
    });

    displayShortUrls();
  </script>
</body>
</html>
